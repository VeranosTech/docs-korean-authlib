<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="An OAuth 1 protocol implementation for requests.Session and aiohttp.ClientSession, powered by Authlib." name="description" />
<title>OAuth 1 Client &mdash; Authlib 0.12.dev documentation</title>
  <link rel="shortcut icon" href="../_static/favicon.ico"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"><link rel="stylesheet" href="../_static/typlog.css?v=0.7.2" type="text/css" />
  <link rel="stylesheet" href="../_static/theme.css?v=0.7.2" type="text/css" />
      <link rel="index" title="색인" href="../genindex.html"/>
      <link rel="search" title="검색" href="../search.html"/>
    <link rel="top" title="Authlib 0.12.dev documentation" href="../index.html"/>
      <link rel="up" title="Client Guide" href="index.html"/>
      <link rel="next" title="OAuth 2 Session" href="oauth2.html"/>
      <link rel="prev" title="Client Guide" href="index.html"/>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-34098939-7');ga('send', 'pageview');</script>
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script><link rel="apple-touch-icon" sizes="180x180" href="https://authlib.org/apple-touch-icon.png">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Authlib">
  <meta property="og:title" content="OAuth 1 Client">
    <meta property="og:description" content="An OAuth 1 protocol implementation for requests.Session and aiohttp.ClientSession, powered by Authlib.">
    <meta property="og:image" content="https://authlib.org/logo.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@authlib">
</head>
<body role="document" data-page="client/oauth1">
  <header class="t-head">
    <div class="t-head_menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 384h384v-42.666H64V384zm0-106.666h384v-42.667H64v42.667zM64 128v42.665h384V128H64z"/></svg></div>
    <a class="t-head_logo" href="../index.html"><img src="../_static/authlib.svg" alt="Logo"/>Authlib
    </a>
  </header>
  <aside class="t-sidebar">
    <div class="t-sidebar_close">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"/></svg>
    </div>
    <div class="inner">
<a class="logo" href="../index.html"><img src="../_static/authlib.svg" alt="Logo"/>
    Authlib
</a><div class="logo_desc">The ultimate Python library in building OAuth and OpenID Connect servers. JWS, JWE, JWK, JWA, JWT are included.</div>
<div class="github_wrap">
  <a class="github" href="https://github.com/lepture/authlib" target="_blank">
    <span class="github_icon"></span>
    <span class="github_stars">
      <strong>-</strong>stars
    </span>
    <span class="github_forks">
      <strong>-</strong>forks
    </span>
  </a>
</div><div class="sponsors">
  <div class="sponsor">
    <a class="image" href="https://auth0.com/overview?utm_source=authlib&utm_medium=devsponsor&utm_campaign=authlib"><img src="https://user-images.githubusercontent.com/290496/39297078-89d00928-497d-11e8-8119-0c53afe14cd0.png" alt="Sponsor"></a>
    <div class="text">The new way to solve Identity. Sponsored by <a href="https://auth0.com/overview?utm_source=authlib&utm_medium=devsponsor&utm_campaign=authlib">auth0.com</a></div>
  </div>
  <div class="patron">
    <a class="patron-button" style="border: 1px solid #3E7FCB;display: inline-block;padding: 4px 18px;border-radius: 20px;color: #3E7FCB;" href="https://www.patreon.com/bePatron?u=8179754">Become a Patron!</a>
  </div>
</div><div class="globaltoc">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../basic/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Client Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">OAuth 1 Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="oauth2.html">OAuth 2 Session</a></li>
<li class="toctree-l2"><a class="reference internal" href="flask.html">Flask OAuth Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="django.html">Django OAuth Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixed.html">OAuthClient</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">Client API References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../jose/index.html">JOSE Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flask/1/index.html">Flask OAuth 1.0 Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flask/2/index.html">Flask OAuth 2.0 Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../django/1/index.html">Django OAuth 1.0 Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specs/index.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

</div><div class="useful-links">
  <h3>Useful Links</h3>
  <ul>
    <li><a href="https://authlib.org/">Homepage</a></li>
    <li><a href="https://blog.authlib.org/">Read Blog</a></li>
    <li><a href="https://authlib.org/plans">Commercial License</a></li>
    <li><a href="https://github.com/lepture/authlib">Star on GitHub</a></li>
    <li><a href="https://twitter.com/authlib">Follow on Twitter</a></li>
    <li><a href="https://stackoverflow.com/questions/tagged/authlib">Help on StackOverflow</a></li>
    <li><a href="https://github.com/authlib/loginpass">Loginpass</a></li>
  </ul>
</div>
<div id="searchbox">
  <form class="search" action="../search.html" method="get">
    <div class="input-group">
      <input type="text" name="q" placeholder="검색" />
      <button type="submit">바로 가기</button>
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    </div>
  </aside>
  <div class="t-content">
    <div class="t-body yue">
  <div class="section" id="oauth-1-client">
<h1>OAuth 1 Client<a class="headerlink" href="#oauth-1-client" title="제목 주소">¶</a></h1>
<span class="target" id="module-authlib.client"></span><div class="section" id="oauth1session-for-requests">
<h2>OAuth1Session for requests<a class="headerlink" href="#oauth1session-for-requests" title="제목 주소">¶</a></h2>
<p>The <a class="reference internal" href="api.html#authlib.client.OAuth1Session" title="authlib.client.OAuth1Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">OAuth1Session</span></code></a> in Authlib is a subclass of <code class="docutils literal notranslate"><span class="pre">requests.Session</span></code>.
It shares the same API with <code class="docutils literal notranslate"><span class="pre">requests.Session</span></code> and extends it with OAuth 1
protocol. This section is a guide on how to obtain an access token in OAuth 1
flow.</p>
<div class="admonition note">
<p class="first admonition-title">주석</p>
<p class="last">If you are using Flask or Django, you may have interests in
<a class="reference internal" href="flask.html#flask-client"><span class="std std-ref">Flask OAuth Client</span></a> and <a class="reference internal" href="django.html#django-client"><span class="std std-ref">Django OAuth Client</span></a>.</p>
</div>
<p>If you are not familiar with OAuth 1.0, it is better to
<a class="reference internal" href="../basic/oauth1.html#understand-oauth1"><span class="std std-ref">Understand OAuth 1.0</span></a> now.</p>
<p>There are three steps in OAuth 1 to obtain an access token. Initialize
the session for reuse:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">authlib.client</span> <span class="k">import</span> <span class="n">OAuth1Session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client_id</span> <span class="o">=</span> <span class="s1">&#39;Your Twitter client key&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client_secret</span> <span class="o">=</span> <span class="s1">&#39;Your Twitter client secret&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">OAuth1Session</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="fetch-temporary-credential">
<span id="fetch-request-token"></span><h3>Fetch Temporary Credential<a class="headerlink" href="#fetch-temporary-credential" title="제목 주소">¶</a></h3>
<p>The first step is to fetch temporary credential, which will be used to generate
authorization URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">request_token_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/request_token&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request_token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">fetch_request_token</span><span class="p">(</span><span class="n">request_token_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">request_token</span><span class="p">)</span>
<span class="go">{&#39;oauth_token&#39;: &#39;gA..H&#39;, &#39;oauth_token_secret&#39;: &#39;lp..X&#39;, &#39;oauth_callback_confirmed&#39;: &#39;true&#39;}</span>
</pre></div>
</div>
<p>Save this temporary credential for later use (if required).</p>
<p>You can assign a <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> before fetching the request token, if
you want to redirect back to another URL other than the one you registered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">=</span> <span class="s1">&#39;https://your-domain.org/auth&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">fetch_request_token</span><span class="p">(</span><span class="n">request_token_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="redirect-to-authorization-endpoint">
<h3>Redirect to Authorization Endpoint<a class="headerlink" href="#redirect-to-authorization-endpoint" title="제목 주소">¶</a></h3>
<p>The second step is to generate the authorization URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">authenticate_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/authenticate&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">create_authorization_url</span><span class="p">(</span><span class="n">authenticate_url</span><span class="p">,</span> <span class="n">request_token</span><span class="p">[</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">])</span>
<span class="go">&#39;https://api.twitter.com/oauth/authenticate?oauth_token=gA..H&#39;</span>
</pre></div>
</div>
<p>Actually, the second parameter <code class="docutils literal notranslate"><span class="pre">request_token</span></code> can be omitted, since session
is re-used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">create_authorization_url</span><span class="p">(</span><span class="n">authenticate_url</span><span class="p">)</span>
</pre></div>
</div>
<p>Now visit the authorization url that <a class="reference internal" href="api.html#authlib.client.OAuth1Session.create_authorization_url" title="authlib.client.OAuth1Session.create_authorization_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">OAuth1Session.create_authorization_url()</span></code></a>
generated, and grant the authorization.</p>
</div>
<div class="section" id="fetch-access-token">
<span id="fetch-oauth1-access-token"></span><h3>Fetch Access Token<a class="headerlink" href="#fetch-access-token" title="제목 주소">¶</a></h3>
<p>When the authorization is granted, you will be redirected back to your
registered callback URI. For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://example.com/twitter?oauth_token=gA..H&amp;oauth_verifier=fcg..1Dq
</pre></div>
</div>
<p>If you assigned <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> in <a class="reference internal" href="#fetch-oauth1-access-token"><span class="std std-ref">Fetch Access Token</span></a>, the
authorize response would be something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://your-domain.org/auth?oauth_token=gA..H&amp;oauth_verifier=fcg..1Dq
</pre></div>
</div>
<p>Now fetch the access token with this response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">resp_url</span> <span class="o">=</span> <span class="s1">&#39;https://example.com/twitter?oauth_token=gA..H&amp;oauth_verifier=fcg..1Dq&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">parse_authorization_response</span><span class="p">(</span><span class="n">resp_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">access_token_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/access_token&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">fetch_access_token</span><span class="p">(</span><span class="n">access_token_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">    &#39;oauth_token&#39;: &#39;12345-st..E&#39;,</span>
<span class="go">    &#39;oauth_token_secret&#39;: &#39;o67..X&#39;,</span>
<span class="go">    &#39;user_id&#39;: &#39;12345&#39;,</span>
<span class="go">    &#39;screen_name&#39;: &#39;lepture&#39;,</span>
<span class="go">    &#39;x_auth_expires&#39;: &#39;0&#39;</span>
<span class="go">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_access_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
<p>Save this token to access protected resources.</p>
<p>The above flow is not always what we will use in a real project. When we are
redirected to authorization endpoint, our session is over. In this case, when
the authorization server send us back to our server, we need to create another
session:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># restore your saved request token, which is a dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request_token</span> <span class="o">=</span> <span class="n">restore_request_token</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">oauth_token</span> <span class="o">=</span> <span class="n">request_token</span><span class="p">[</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">oauth_token_secret</span> <span class="o">=</span> <span class="n">request_token</span><span class="p">[</span><span class="s1">&#39;oauth_token_secret&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">OAuth1Session</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">token</span><span class="o">=</span><span class="n">oauth_token</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">token_secret</span><span class="o">=</span><span class="n">oauth_token_secret</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># there is no need for `parse_authorization_response` if you can get `verifier`</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verifier</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verifier&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">access_token_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/access_token&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">fetch_access_token</span><span class="p">(</span><span class="n">access_token_url</span><span class="p">,</span> <span class="n">verifier</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="access-protected-resources">
<h3>Access Protected Resources<a class="headerlink" href="#access-protected-resources" title="제목 주소">¶</a></h3>
<p>Now you can access the protected resources. If you re-use the session, you
don't need to do anything:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">account_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/account/verify_credentials.json&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">account_url</span><span class="p">)</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">{...}</span>
</pre></div>
</div>
<p>The above is not the real flow, just like what we did in
<a class="reference internal" href="#fetch-oauth1-access-token"><span class="std std-ref">Fetch Access Token</span></a>, we need to create another session ourselves:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">access_token</span> <span class="o">=</span> <span class="n">restore_access_token_from_database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">oauth_token</span> <span class="o">=</span> <span class="n">access_token</span><span class="p">[</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">oauth_token_secret</span> <span class="o">=</span> <span class="n">access_token</span><span class="p">[</span><span class="s1">&#39;oauth_token_secret&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">OAuth1Session</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">token</span><span class="o">=</span><span class="n">oauth_token</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">token_secret</span><span class="o">=</span><span class="n">oauth_token_secret</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/account/verify_credentials.json&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">account_url</span><span class="p">)</span>
</pre></div>
</div>
<p>Please note, there are duplicated steps in the documentation, read carefully
and ignore the duplicated explains.</p>
</div>
<div class="section" id="using-oauth1auth">
<h3>Using OAuth1Auth<a class="headerlink" href="#using-oauth1auth" title="제목 주소">¶</a></h3>
<p>It is also possible to access protected resources with <code class="docutils literal notranslate"><span class="pre">OAuth1Auth</span></code> object.
Create an instance of OAuth1Auth with an access token:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span> <span class="o">=</span> <span class="n">OAuth1Auth</span><span class="p">(</span>
    <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;..&#39;</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;..&#39;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s1">&#39;oauth_token value&#39;</span><span class="p">,</span>
    <span class="n">token_secret</span><span class="o">=</span><span class="s1">&#39;oauth_token_secret value&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Pass this <code class="docutils literal notranslate"><span class="pre">auth</span></code> to <a href="#id1"><span class="problematic" id="id2">``</span></a>requests` to access protected resources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/account/verify_credentials.json&#39;</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="asyncoauth1client-for-aiohttp">
<h2>AsyncOAuth1Client for aiohttp<a class="headerlink" href="#asyncoauth1client-for-aiohttp" title="제목 주소">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">버전 v0.11에 추가: </span>This is an experimental feature.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">AsyncOAuth1Client</span></code> is located in <code class="docutils literal notranslate"><span class="pre">authlib.client.aiohttp</span></code>. Authlib doesn't
embed <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> as a dependency, you need to install it yourself.</p>
<p>Here is an example on how you can initialize an instance of <code class="docutils literal notranslate"><span class="pre">AsyncOAuth1Client</span></code>
for <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">ClientSession</span>
<span class="kn">from</span> <span class="nn">authlib.client.aiohttp</span> <span class="k">import</span> <span class="n">AsyncOAuth1Client</span><span class="p">,</span> <span class="n">OAuthRequest</span>

<span class="n">REQUEST_TOKEN_URL</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/request_token&#39;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># OAuthRequest is required to handle auth</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">(</span><span class="n">request_class</span><span class="o">=</span><span class="n">OAuthRequest</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncOAuth1Client</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s1">&#39;client_id&#39;</span><span class="p">,</span> <span class="s1">&#39;client_secret&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_request_token</span><span class="p">(</span><span class="n">REQUEST_TOKEN_URL</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>The API is similar with <code class="docutils literal notranslate"><span class="pre">OAuth1Session</span></code> above. Using the <code class="docutils literal notranslate"><span class="pre">client</span></code> for the
three steps authorization:</p>
<div class="section" id="id3">
<h3>Fetch Temporary Credential<a class="headerlink" href="#id3" title="제목 주소">¶</a></h3>
<p>The first step is to fetch temporary credential, which will be used to generate
authorization URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">request_token_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/request_token&#39;</span>
<span class="n">request_token</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_request_token</span><span class="p">(</span><span class="n">request_token_url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request_token</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">:</span> <span class="s1">&#39;gA..H&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth_token_secret&#39;</span><span class="p">:</span> <span class="s1">&#39;lp..X&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth_callback_confirmed&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Save this temporary credential for later use (if required).</p>
</div>
<div class="section" id="id4">
<h3>Redirect to Authorization Endpoint<a class="headerlink" href="#id4" title="제목 주소">¶</a></h3>
<p>The second step is to generate the authorization URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authenticate_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/authenticate&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_authorization_url</span><span class="p">(</span><span class="n">authenticate_url</span><span class="p">,</span> <span class="n">request_token</span><span class="p">[</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="s1">&#39;https://api.twitter.com/oauth/authenticate?oauth_token=gA..H&#39;</span>
</pre></div>
</div>
<p>Actually, the second parameter <code class="docutils literal notranslate"><span class="pre">request_token</span></code> can be omitted, since session
is re-used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_authorization_url</span><span class="p">(</span><span class="n">authenticate_url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="s1">&#39;https://api.twitter.com/oauth/authenticate?oauth_token=gA..H&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Fetch Access Token<a class="headerlink" href="#id5" title="제목 주소">¶</a></h3>
<p>When the authorization is granted, you will be redirected back to your
registered callback URI. For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://example.com/twitter?oauth_token=gA..H&amp;oauth_verifier=fcg..1Dq
</pre></div>
</div>
<p>If you assigned <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> in <a class="reference internal" href="#fetch-oauth1-access-token"><span class="std std-ref">Fetch Access Token</span></a>, the
authorize response would be something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://your-domain.org/auth?oauth_token=gA..H&amp;oauth_verifier=fcg..1Dq
</pre></div>
</div>
<p>In the production flow, you may need to create a new instance of
<code class="docutils literal notranslate"><span class="pre">AsyncOAuth1Client</span></code>, it is the same as above. You need to use the previous
request token to exchange an access token:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># twitter redirected back to your website</span>
<span class="n">resp_url</span> <span class="o">=</span> <span class="s1">&#39;https://example.com/twitter?oauth_token=gA..H&amp;oauth_verifier=fcg..1Dq&#39;</span>

<span class="c1"># you may use the ``oauth_token`` in resp_url to</span>
<span class="c1"># get back your previous request token</span>
<span class="n">request_token</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">:</span> <span class="s1">&#39;gA..H&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth_token_secret&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">}</span>

<span class="c1"># assign request token to client</span>
<span class="n">client</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">request_token</span>

<span class="c1"># resolve the ``oauth_verifier`` from resp_url</span>
<span class="n">oauth_verifier</span> <span class="o">=</span> <span class="n">get_oauth_verifier_value</span><span class="p">(</span><span class="n">resp_url</span><span class="p">)</span>

<span class="n">access_token_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/oauth/access_token&#39;</span>
<span class="n">token</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_access_token</span><span class="p">(</span><span class="n">access_token_url</span><span class="p">,</span> <span class="n">oauth_verifier</span><span class="p">)</span>
</pre></div>
</div>
<p>You can save the <code class="docutils literal notranslate"><span class="pre">token</span></code> to access protected resources later.</p>
</div>
<div class="section" id="id6">
<h3>Access Protected Resources<a class="headerlink" href="#id6" title="제목 주소">¶</a></h3>
<p>Now you can access the protected resources. Usually, you will need to create
an instance of <code class="docutils literal notranslate"><span class="pre">AsyncOAuth1Client</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get back the access token if you have saved it in some place</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;oauth_token&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth_secret&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">}</span>

<span class="c1"># assign it to client</span>
<span class="n">client</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">access_token</span>

<span class="n">account_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/account/verify_credentials.json&#39;</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">account_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
<p>Notice, it is also possible to create the client instance with access token at
the initialization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">AsyncOAuth1Client</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span> <span class="s1">&#39;client_id&#39;</span><span class="p">,</span> <span class="s1">&#39;client_secret&#39;</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="n">token_secret</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">경고</p>
<p class="last">This is still an experimental feature in Authlib. Use it with caution.</p>
</div>
</div>
</div>
</div>

  <div class="t-pagination clearfix">
    <span>
      ← <a href="index.html" title="Client Guide">Client Guide</a>
    </span>
    <span style="float:right">
      <a href="oauth2.html" title="OAuth 2 Session">OAuth 2 Session</a> →
    </span>
  </div>
</div><footer class="t-foot">
    &copy; Copyright 2018, Hsiaoming Ltd.
    <br>
    A <a href="https://typlog.com/">typlog</a> <a href="https://github.com/typlog/sphinx-typlog-theme">sphinx theme</a>,
    designed by <a href="https://lepture.com/">Hsiaoming Yang</a>.
</footer>
  </div>
  <script>$(function(){$(".t-head_menu").on("click",function(){$("body").addClass("_expand")});$(".t-body").on("click",function(){$("body").removeClass("_expand")});$(".t-sidebar_close").on("click",function(){$("body").removeClass("_expand")});$("a.footnote-reference").on("click",function(e){e.preventDefault();var id=$(this).attr("href");var html=$(id).find("td.label + td").html();var w=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var style="top:"+e.pageY+"px;";if(w>560){style+="width:480px;";if(e.pageX>240&&e.pageX+240<w){style+="left:"+(e.pageX-240)+"px;"}else if(e.pageX<=240){style+="left:20px;"}else{style+="right:20px;"}}showFootnote(html,style)});function showFootnote(html,style){var CONTENT_ID="typlog-footnote-content";var content=document.getElementById(CONTENT_ID);if(!content){content=document.createElement("div");content.id=CONTENT_ID;$(".t-body").append(content)}var MASK_ID="typlog-footnote-mask";var mask=document.getElementById(MASK_ID);if(!mask){mask=document.createElement("div");mask.id=MASK_ID;document.body.appendChild(mask);mask.addEventListener("click",function(){content.className="";mask.className=""})}content.innerHTML=html;content.setAttribute("style",style);content.className="_active";mask.className="_active"}function fetchGitHubRepo(repo){var url="https://api.github.com/repos/"+repo;$.getJSON(url,function(data){var counts=[+new Date,data.stargazers_count,data.forks_count];localStorage.setItem("gh:"+repo,JSON.stringify(counts));updateGitHubStats(counts[1],counts[2])})}function updateGitHubStats(stars,forks){$(".github_stars strong").text(stars);$(".github_forks strong").text(forks)}function initGitHub(url){if(!url){return}var repo=url.replace("https://github.com/","");var cache=localStorage.getItem("gh:"+repo);if(cache){try{var counts=JSON.parse(cache);updateGitHubStats(counts[1],counts[2]);var delta=new Date-counts[0];if(delta<0||delta>9e5){fetchGitHubRepo(repo)}}catch(error){fetchGitHubRepo(repo)}}else{fetchGitHubRepo(repo)}}initGitHub($(".github").attr("href"))});</script>
</body>
</html>