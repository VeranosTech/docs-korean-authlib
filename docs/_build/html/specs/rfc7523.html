<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="API references on RFC7523 JWT Bearer Grant of Python implementation, guide on how to create a server that support JWT profile for OAuth 2.0 client authentication and authorization grants." name="description" />
<title>RFC7523: JWT Profile for OAuth 2.0 Client Authentication and Authorization Grants &mdash; Authlib 0.12.dev documentation</title>
  <link rel="shortcut icon" href="../_static/favicon.ico"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"><link rel="stylesheet" href="../_static/typlog.css?v=0.7.2" type="text/css" />
  <link rel="stylesheet" href="../_static/theme.css?v=0.7.2" type="text/css" />
      <link rel="index" title="색인" href="../genindex.html"/>
      <link rel="search" title="검색" href="../search.html"/>
    <link rel="top" title="Authlib 0.12.dev documentation" href="../index.html"/>
      <link rel="up" title="Specifications" href="index.html"/>
      <link rel="next" title="RFC7636: Proof Key for Code Exchange by OAuth Public Clients" href="rfc7636.html"/>
      <link rel="prev" title="RFC7519: JSON Web Token" href="rfc7519.html"/>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-34098939-7');ga('send', 'pageview');</script>
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script><link rel="apple-touch-icon" sizes="180x180" href="https://authlib.org/apple-touch-icon.png">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Authlib">
  <meta property="og:title" content="RFC7523: JWT Profile for OAuth 2.0 Client Authentication and Authorization Grants">
    <meta property="og:description" content="API references on RFC7523 JWT Bearer Grant of Python implementation, guide on how to create a server that support JWT profile for OAuth 2.0 client authentication and authorization grants.">
    <meta property="og:image" content="https://authlib.org/logo.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@authlib">
</head>
<body role="document" data-page="specs/rfc7523">
  <header class="t-head">
    <div class="t-head_menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 384h384v-42.666H64V384zm0-106.666h384v-42.667H64v42.667zM64 128v42.665h384V128H64z"/></svg></div>
    <a class="t-head_logo" href="../index.html"><img src="../_static/authlib.svg" alt="Logo"/>Authlib
    </a>
  </header>
  <aside class="t-sidebar">
    <div class="t-sidebar_close">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"/></svg>
    </div>
    <div class="inner">
<a class="logo" href="../index.html"><img src="../_static/authlib.svg" alt="Logo"/>
    Authlib
</a><div class="logo_desc">The ultimate Python library in building OAuth and OpenID Connect servers. JWS, JWE, JWK, JWA, JWT are included.</div>
<div class="github_wrap">
  <a class="github" href="https://github.com/lepture/authlib" target="_blank">
    <span class="github_icon"></span>
    <span class="github_stars">
      <strong>-</strong>stars
    </span>
    <span class="github_forks">
      <strong>-</strong>forks
    </span>
  </a>
</div><div class="sponsors">
  <div class="sponsor">
    <a class="image" href="https://auth0.com/overview?utm_source=authlib&utm_medium=devsponsor&utm_campaign=authlib"><img src="https://user-images.githubusercontent.com/290496/39297078-89d00928-497d-11e8-8119-0c53afe14cd0.png" alt="Sponsor"></a>
    <div class="text">The new way to solve Identity. Sponsored by <a href="https://auth0.com/overview?utm_source=authlib&utm_medium=devsponsor&utm_campaign=authlib">auth0.com</a></div>
  </div>
  <div class="patron">
    <a class="patron-button" style="border: 1px solid #3E7FCB;display: inline-block;padding: 4px 18px;border-radius: 20px;color: #3E7FCB;" href="https://www.patreon.com/bePatron?u=8179754">Become a Patron!</a>
  </div>
</div><div class="globaltoc">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../basic/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client/index.html">Client Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jose/index.html">JOSE Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flask/1/index.html">Flask OAuth 1.0 Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flask/2/index.html">Flask OAuth 2.0 Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../django/1/index.html">Django OAuth 1.0 Server</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="rfc5849.html">RFC5849: The OAuth 1.0 Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc6749.html">RFC6749: The OAuth 2.0 Authorization Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc6750.html">RFC6750: The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7009.html">RFC7009: OAuth 2.0 Token Revocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7515.html">RFC7515: JSON Web Signature</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7516.html">RFC7516: JSON Web Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7517.html">RFC7517: JSON Web Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7518.html">RFC7518: JSON Web Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7519.html">RFC7519: JSON Web Token</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">RFC7523: JWT Profile for OAuth 2.0 Client Authentication and Authorization Grants</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7636.html">RFC7636: Proof Key for Code Exchange by OAuth Public Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc7662.html">RFC7662: OAuth 2.0 Token Introspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="oidc.html">OpenID Connect 1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

</div><div class="useful-links">
  <h3>Useful Links</h3>
  <ul>
    <li><a href="https://authlib.org/">Homepage</a></li>
    <li><a href="https://blog.authlib.org/">Read Blog</a></li>
    <li><a href="https://authlib.org/plans">Commercial License</a></li>
    <li><a href="https://github.com/lepture/authlib">Star on GitHub</a></li>
    <li><a href="https://twitter.com/authlib">Follow on Twitter</a></li>
    <li><a href="https://stackoverflow.com/questions/tagged/authlib">Help on StackOverflow</a></li>
    <li><a href="https://github.com/authlib/loginpass">Loginpass</a></li>
  </ul>
</div>
<div id="searchbox">
  <form class="search" action="../search.html" method="get">
    <div class="input-group">
      <input type="text" name="q" placeholder="검색" />
      <button type="submit">바로 가기</button>
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    </div>
  </aside>
  <div class="t-content">
    <div class="t-body yue">
  <div class="section" id="rfc7523-jwt-profile-for-oauth-2-0-client-authentication-and-authorization-grants">
<span id="specs-rfc7523"></span><h1>RFC7523: JWT Profile for OAuth 2.0 Client Authentication and Authorization Grants<a class="headerlink" href="#rfc7523-jwt-profile-for-oauth-2-0-client-authentication-and-authorization-grants" title="제목 주소">¶</a></h1>
<p>This section contains the generic Python implementation of <a class="reference external" href="https://tools.ietf.org/html/rfc7523">RFC7523</a>.</p>
<span class="target" id="module-authlib.oauth2.rfc7523"></span><div class="section" id="using-jwts-as-authorization-grants">
<span id="jwt-grant-type"></span><h2>Using JWTs as Authorization Grants<a class="headerlink" href="#using-jwts-as-authorization-grants" title="제목 주소">¶</a></h2>
<p>JWT Profile for OAuth 2.0 Authorization Grants works in the same way with
<a class="reference internal" href="rfc6749.html#specs-rfc6749"><span class="std std-ref">RFC6749</span></a> built-in grants. Which means it can be
registered with <a class="reference internal" href="rfc6749.html#authlib.oauth2.rfc6749.AuthorizationServer.register_grant" title="authlib.oauth2.rfc6749.AuthorizationServer.register_grant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_grant()</span></code></a>.</p>
<p>The base class is <a class="reference internal" href="#authlib.oauth2.rfc7523.JWTBearerGrant" title="authlib.oauth2.rfc7523.JWTBearerGrant"><code class="xref py py-class docutils literal notranslate"><span class="pre">JWTBearerGrant</span></code></a>, you need to implement the missing
methods in order to use it. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">authlib.jose</span> <span class="k">import</span> <span class="n">jwk</span>
<span class="kn">from</span> <span class="nn">authlib.oauth2.rfc7523</span> <span class="k">import</span> <span class="n">JWTBearerGrant</span> <span class="k">as</span> <span class="n">_JWTBearerGrant</span>

<span class="k">class</span> <span class="nc">JWTBearerGrant</span><span class="p">(</span><span class="n">_JWTBearerGrant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">authenticate_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">claims</span><span class="p">):</span>
        <span class="c1"># get user from claims info, usually it is claims[&#39;sub&#39;]</span>
        <span class="c1"># for anonymous user, return None</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">authenticate_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">claims</span><span class="p">):</span>
        <span class="c1"># get client from claims, usually it is claims[&#39;iss&#39;]</span>
        <span class="c1"># since the assertion JWT is generated by this client</span>
        <span class="k">return</span> <span class="n">get_client_by_iss</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">resolve_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="c1"># get public key to decode the assertion JWT</span>
        <span class="n">jwk_set</span> <span class="o">=</span> <span class="n">get_client_public_keys</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">jwk</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jwk_set</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kid&#39;</span><span class="p">))</span>

<span class="c1"># register grant to authorization server</span>
<span class="n">authorization_server</span><span class="o">.</span><span class="n">register_grant</span><span class="p">(</span><span class="n">JWTBearerGrant</span><span class="p">)</span>
</pre></div>
</div>
<p>When creating a client, authorization server will generate several key pairs.
The server itself can only keep the public keys, which will be used to decode
assertion value.</p>
<p>For <strong>client implementation</strong>, check out <a class="reference internal" href="../client/api.html#authlib.client.AssertionSession" title="authlib.client.AssertionSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssertionSession</span></code></a>.</p>
</div>
<div class="section" id="using-jwts-for-client-authentication">
<span id="jwt-client-authentication"></span><h2>Using JWTs for Client Authentication<a class="headerlink" href="#using-jwts-for-client-authentication" title="제목 주소">¶</a></h2>
<p>In <a class="reference internal" href="rfc6749.html#specs-rfc6749"><span class="std std-ref">RFC6749: The OAuth 2.0 Authorization Framework</span></a>, Authlib provided three built-in client authentication
methods, which are <code class="docutils literal notranslate"><span class="pre">none</span></code>, <code class="docutils literal notranslate"><span class="pre">client_secret_post</span></code> and <code class="docutils literal notranslate"><span class="pre">client_secret_basic</span></code>.
With the power of Assertion Framework, we can add more client authentication
methods. In this section, Authlib provides two more options:
<code class="docutils literal notranslate"><span class="pre">client_secret_jwt</span></code> and <code class="docutils literal notranslate"><span class="pre">private_key_jwt</span></code>. RFC7523 itself doesn't define
any names, these two names are defined by OpenID Connect in <a class="reference external" href="http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication">ClientAuthentication</a>.</p>
<p>The <a class="reference internal" href="rfc6749.html#authlib.oauth2.rfc6749.AuthorizationServer" title="authlib.oauth2.rfc6749.AuthorizationServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthorizationServer</span></code></a> has provided a method
<a class="reference internal" href="rfc6749.html#authlib.oauth2.rfc6749.AuthorizationServer.register_client_auth_method" title="authlib.oauth2.rfc6749.AuthorizationServer.register_client_auth_method"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_client_auth_method()</span></code></a>
to add more client authentication methods.</p>
<p>In Authlib, <code class="docutils literal notranslate"><span class="pre">client_secret_jwt</span></code> and <code class="docutils literal notranslate"><span class="pre">private_key_jwt</span></code> share the same API,
using <a class="reference internal" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion" title="authlib.oauth2.rfc7523.JWTBearerClientAssertion"><code class="xref py py-class docutils literal notranslate"><span class="pre">JWTBearerClientAssertion</span></code></a> to create a new client authentication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">JWTClientAuth</span><span class="p">(</span><span class="n">JWTBearerClientAssertion</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">validate_jti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">claims</span><span class="p">,</span> <span class="n">jti</span><span class="p">):</span>
        <span class="c1"># validate_jti is required by OpenID Connect</span>
        <span class="c1"># but it is optional by RFC7523</span>
        <span class="c1"># use cache to validate jti value</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;jti:</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">],</span> <span class="n">jti</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">resolve_client_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;alg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HS256&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">client_secret</span>
        <span class="k">if</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;alg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RS256&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">public_key</span>
        <span class="c1"># you may support other ``alg`` value</span>

<span class="n">authorization_server</span><span class="o">.</span><span class="n">register_client_auth_method</span><span class="p">(</span>
    <span class="n">JWTClientAuth</span><span class="o">.</span><span class="n">CLIENT_AUTH_METHOD</span><span class="p">,</span>
    <span class="n">JWTClientAuth</span><span class="p">(</span><span class="s1">&#39;https://example.com/oauth/token&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The value <code class="docutils literal notranslate"><span class="pre">https://example.com/oauth/token</span></code> is your authorization servers's
token endpoint, which is used as <code class="docutils literal notranslate"><span class="pre">aud</span></code> value in JWT.</p>
<p>Now we have added this client auth method to authorization server, but no
grant types support this authentication method, you need to add it to the
supported grant types too, e.g. we want to support this in authorization
code grant:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">authlib.oauth2.rfc6749</span> <span class="k">import</span> <span class="n">grants</span>

<span class="k">class</span> <span class="nc">AuthorizationCodeGrant</span><span class="p">(</span><span class="n">grants</span><span class="o">.</span><span class="n">AuthorizationCodeGrant</span><span class="p">):</span>
    <span class="n">TOKEN_ENDPOINT_AUTH_METHODS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;client_secret_basic&#39;</span><span class="p">,</span>
        <span class="n">JWTClientAuth</span><span class="o">.</span><span class="n">CLIENT_AUTH_METHOD</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>You may noticed that the value of <code class="docutils literal notranslate"><span class="pre">CLIENT_AUTH_METHOD</span></code> is
<code class="docutils literal notranslate"><span class="pre">client_assertion_jwt</span></code>. It is not <code class="docutils literal notranslate"><span class="pre">client_secret_jwt</span></code> or
<code class="docutils literal notranslate"><span class="pre">private_key_jwt</span></code>, because they have the same logic. In the above
implementation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resolve_client_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
    <span class="n">alg</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;alg&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If this <code class="docutils literal notranslate"><span class="pre">alg</span></code> is a MAC SHA like <code class="docutils literal notranslate"><span class="pre">HS256</span></code>, it is called <code class="docutils literal notranslate"><span class="pre">client_secret_jwt</span></code>,
because the key used to sign a JWT is the client's <code class="docutils literal notranslate"><span class="pre">client_secret</span></code> value. If
this <code class="docutils literal notranslate"><span class="pre">alg</span></code> is <code class="docutils literal notranslate"><span class="pre">RS256</span></code> or something else, it is called <code class="docutils literal notranslate"><span class="pre">private_key_jwt</span></code>,
because client will use its private key to sign the JWT. You can set a limitation
in the implementation of <code class="docutils literal notranslate"><span class="pre">resolve_client_public_key</span></code> to accept only <code class="docutils literal notranslate"><span class="pre">HS256</span></code>
alg, in this case, you can also alter <code class="docutils literal notranslate"><span class="pre">CLIENT_AUTH_METHOD</span> <span class="pre">=</span> <span class="pre">'client_secret_jwt'</span></code>.</p>
</div>
<div class="section" id="using-jwts-client-assertion-in-oauth2session">
<span id="jwt-oauth2session"></span><h2>Using JWTs Client Assertion in OAuth2Session<a class="headerlink" href="#using-jwts-client-assertion-in-oauth2session" title="제목 주소">¶</a></h2>
<p>Authlib RFC7523 has provided you a helper function to register client assertion
authentication method easily to <code class="docutils literal notranslate"><span class="pre">OAuth2Session</span></code>. Take <code class="docutils literal notranslate"><span class="pre">client_secret_jwt</span></code>
as an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">authlib.oauth2.rfc7523</span> <span class="k">import</span> <span class="n">register_session_client_auth_method</span>
<span class="kn">from</span> <span class="nn">authlib.client</span> <span class="k">import</span> <span class="n">OAuth2Session</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">OAuth2Session</span><span class="p">(</span>
    <span class="s1">&#39;your-client-id&#39;</span><span class="p">,</span> <span class="s1">&#39;your-client-secret&#39;</span><span class="p">,</span>
    <span class="n">token_endpoint_auth_method</span><span class="o">=</span><span class="s1">&#39;client_secret_jwt&#39;</span>
<span class="p">)</span>
<span class="c1"># just one hook here</span>
<span class="n">register_session_client_auth_method</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">fetch_access_token</span><span class="p">(</span><span class="s1">&#39;https://example.com/oauth/token&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>How about <code class="docutils literal notranslate"><span class="pre">private_key_jwt</span></code>? It is the same as <code class="docutils literal notranslate"><span class="pre">client_secret_jwt</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;your-private-key.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">private_key</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">OAuth2Session</span><span class="p">(</span>
    <span class="s1">&#39;your-client-id&#39;</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span>
    <span class="n">token_endpoint_auth_method</span><span class="o">=</span><span class="s1">&#39;private_key_jwt&#39;</span>  <span class="c1"># NOTICE HERE</span>
<span class="p">)</span>
<span class="n">register_session_client_auth_method</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">fetch_access_token</span><span class="p">(</span><span class="s1">&#39;https://example.com/oauth/token&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="제목 주소">¶</a></h2>
<dl class="class">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant">
<em class="property">class </em><code class="descclassname">authlib.oauth2.rfc7523.</code><code class="descname">JWTBearerGrant</code><span class="sig-paren">(</span><em>request</em>, <em>server</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant" title="정의 주소">¶</a></dt>
<dd><dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.create_claims_options">
<code class="descname">create_claims_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.create_claims_options" title="정의 주소">¶</a></dt>
<dd><p>Create a claims_options for verify JWT payload claims. Developers
MAY overwrite this method to create a more strict options.</p>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.process_assertion_claims">
<code class="descname">process_assertion_claims</code><span class="sig-paren">(</span><em>assertion</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.process_assertion_claims" title="정의 주소">¶</a></dt>
<dd><p>Extract JWT payload claims from request &quot;assertion&quot;, per
<a class="reference external" href="https://tools.ietf.org/html/rfc7523#section-3.1">Section 3.1</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">매개 변수:</th><td class="field-body"><strong>assertion</strong> -- assertion string value in the request</td>
</tr>
<tr class="field-even field"><th class="field-name">반환:</th><td class="field-body">JWTClaims</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raise:</th><td class="field-body">InvalidGrantError</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.validate_token_request">
<code class="descname">validate_token_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.validate_token_request" title="정의 주소">¶</a></dt>
<dd><p>The client makes a request to the token endpoint by sending the
following parameters using the &quot;application/x-www-form-urlencoded&quot;
format per <a class="reference external" href="https://tools.ietf.org/html/rfc7523#section-2.1">Section 2.1</a>:</p>
<dl class="docutils">
<dt>grant_type</dt>
<dd>REQUIRED.  Value MUST be set to
&quot;<a class="reference external" href="urn:ietf:params:oauth:grant-type:jwt-bearer">urn:ietf:params:oauth:grant-type:jwt-bearer</a>&quot;.</dd>
<dt>assertion</dt>
<dd>REQUIRED.  Value MUST contain a single JWT.</dd>
<dt>scope</dt>
<dd>OPTIONAL.</dd>
</dl>
<p>The following example demonstrates an access token request with a JWT
as an authorization grant:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/token.oauth2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">as.example.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer
&amp;assertion=eyJhbGciOiJFUzI1NiIsImtpZCI6IjE2In0.
eyJpc3Mi[...omitted for brevity...].
J9l-ZhwP[...omitted for brevity...]
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.create_token_response">
<code class="descname">create_token_response</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.create_token_response" title="정의 주소">¶</a></dt>
<dd><p>If valid and authorized, the authorization server issues an access
token.</p>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.authenticate_user">
<code class="descname">authenticate_user</code><span class="sig-paren">(</span><em>claims</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.authenticate_user" title="정의 주소">¶</a></dt>
<dd><p>Authenticate user with the given assertion claims. Developers MUST
implement it in subclass, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">authenticate_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">claims</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">get_by_sub</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">매개 변수:</th><td class="field-body"><strong>claims</strong> -- assertion payload claims</td>
</tr>
<tr class="field-even field"><th class="field-name">반환:</th><td class="field-body">User instance</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.authenticate_client">
<code class="descname">authenticate_client</code><span class="sig-paren">(</span><em>claims</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.authenticate_client" title="정의 주소">¶</a></dt>
<dd><p>Authenticate client with the given assertion claims. Developers MUST
implement it in subclass, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">authenticate_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">claims</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Client</span><span class="o">.</span><span class="n">get_by_iss</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">매개 변수:</th><td class="field-body"><strong>claims</strong> -- assertion payload claims</td>
</tr>
<tr class="field-even field"><th class="field-name">반환:</th><td class="field-body">Client instance</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerGrant.resolve_public_key">
<code class="descname">resolve_public_key</code><span class="sig-paren">(</span><em>headers</em>, <em>payload</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerGrant.resolve_public_key" title="정의 주소">¶</a></dt>
<dd><p>Find public key to verify assertion signature. Developers MUST
implement it in subclass, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resolve_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
    <span class="n">jwk_set</span> <span class="o">=</span> <span class="n">get_jwk_set_by_iss</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">filter_jwk_set</span><span class="p">(</span><span class="n">jwk_set</span><span class="p">,</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;kid&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">매개 변수:</th><td class="field-body"><ul class="first simple">
<li><strong>headers</strong> -- JWT headers dict</li>
<li><strong>payload</strong> -- JWT payload dict</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">반환:</th><td class="field-body"><p class="first last">A public key</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion">
<em class="property">class </em><code class="descclassname">authlib.oauth2.rfc7523.</code><code class="descname">JWTBearerClientAssertion</code><span class="sig-paren">(</span><em>token_url</em>, <em>validate_jti=True</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion" title="정의 주소">¶</a></dt>
<dd><p>Implementation of Using JWTs for Client Authentication, which is
defined by RFC7523.</p>
<dl class="attribute">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion.CLIENT_ASSERTION_TYPE">
<code class="descname">CLIENT_ASSERTION_TYPE</code><em class="property"> = 'urn:ietf:params:oauth:client-assertion-type:jwt-bearer'</em><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion.CLIENT_ASSERTION_TYPE" title="정의 주소">¶</a></dt>
<dd><p>Value of <code class="docutils literal notranslate"><span class="pre">client_assertion_type</span></code> of JWTs</p>
</dd></dl>

<dl class="attribute">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion.CLIENT_AUTH_METHOD">
<code class="descname">CLIENT_AUTH_METHOD</code><em class="property"> = 'client_assertion_jwt'</em><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion.CLIENT_AUTH_METHOD" title="정의 주소">¶</a></dt>
<dd><p>Name of the client authentication method</p>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion.create_claims_options">
<code class="descname">create_claims_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion.create_claims_options" title="정의 주소">¶</a></dt>
<dd><p>Create a claims_options for verify JWT payload claims. Developers
MAY overwrite this method to create a more strict options.</p>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion.process_assertion_claims">
<code class="descname">process_assertion_claims</code><span class="sig-paren">(</span><em>assertion</em>, <em>resolve_key</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion.process_assertion_claims" title="정의 주소">¶</a></dt>
<dd><p>Extract JWT payload claims from request &quot;assertion&quot;, per
<a class="reference external" href="https://tools.ietf.org/html/rfc7523#section-3.1">Section 3.1</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">매개 변수:</th><td class="field-body"><ul class="first simple">
<li><strong>assertion</strong> -- assertion string value in the request</li>
<li><strong>resolve_key</strong> -- function to resolve the sign key</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">반환:</th><td class="field-body"><p class="first">JWTClaims</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raise:</th><td class="field-body"><p class="first last">InvalidClientError</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion.validate_jti">
<code class="descname">validate_jti</code><span class="sig-paren">(</span><em>claims</em>, <em>jti</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion.validate_jti" title="정의 주소">¶</a></dt>
<dd><p>Validate if the given <code class="docutils literal notranslate"><span class="pre">jti</span></code> value is used before. Developers
MUST implement this method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_jti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">claims</span><span class="p">,</span> <span class="n">jti</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;jti:</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">],</span> <span class="n">jti</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">redis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">redis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="authlib.oauth2.rfc7523.JWTBearerClientAssertion.resolve_client_public_key">
<code class="descname">resolve_client_public_key</code><span class="sig-paren">(</span><em>client</em>, <em>headers</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.JWTBearerClientAssertion.resolve_client_public_key" title="정의 주소">¶</a></dt>
<dd><p>Resolve the client public key for verifying the JWT signature.
A client may have many public keys, in this case, we can retrieve it
via <code class="docutils literal notranslate"><span class="pre">kid</span></code> value in headers. Developers MUST implement this method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resolve_client_public_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">public_key</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="authlib.oauth2.rfc7523.register_session_client_auth_method">
<code class="descclassname">authlib.oauth2.rfc7523.</code><code class="descname">register_session_client_auth_method</code><span class="sig-paren">(</span><em>session</em>, <em>token_url=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#authlib.oauth2.rfc7523.register_session_client_auth_method" title="정의 주소">¶</a></dt>
<dd><p>Register &quot;client_secret_jwt&quot; or &quot;private_key_jwt&quot; token endpoint auth
method to OAuth2Session.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">매개 변수:</th><td class="field-body"><ul class="first last simple">
<li><strong>session</strong> -- OAuth2Session instance.</li>
<li><strong>token_url</strong> -- Optional token endpoint url.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>

  <div class="t-pagination clearfix">
    <span>
      ← <a href="rfc7519.html" title="RFC7519: JSON Web Token">RFC7519: JSON Web Token</a>
    </span>
    <span style="float:right">
      <a href="rfc7636.html" title="RFC7636: Proof Key for Code Exchange by OAuth Public Clients">RFC7636: Proof Key for...</a> →
    </span>
  </div>
</div><footer class="t-foot">
    &copy; Copyright 2018, Hsiaoming Ltd.
    <br>
    A <a href="https://typlog.com/">typlog</a> <a href="https://github.com/typlog/sphinx-typlog-theme">sphinx theme</a>,
    designed by <a href="https://lepture.com/">Hsiaoming Yang</a>.
</footer>
  </div>
  <script>$(function(){$(".t-head_menu").on("click",function(){$("body").addClass("_expand")});$(".t-body").on("click",function(){$("body").removeClass("_expand")});$(".t-sidebar_close").on("click",function(){$("body").removeClass("_expand")});$("a.footnote-reference").on("click",function(e){e.preventDefault();var id=$(this).attr("href");var html=$(id).find("td.label + td").html();var w=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var style="top:"+e.pageY+"px;";if(w>560){style+="width:480px;";if(e.pageX>240&&e.pageX+240<w){style+="left:"+(e.pageX-240)+"px;"}else if(e.pageX<=240){style+="left:20px;"}else{style+="right:20px;"}}showFootnote(html,style)});function showFootnote(html,style){var CONTENT_ID="typlog-footnote-content";var content=document.getElementById(CONTENT_ID);if(!content){content=document.createElement("div");content.id=CONTENT_ID;$(".t-body").append(content)}var MASK_ID="typlog-footnote-mask";var mask=document.getElementById(MASK_ID);if(!mask){mask=document.createElement("div");mask.id=MASK_ID;document.body.appendChild(mask);mask.addEventListener("click",function(){content.className="";mask.className=""})}content.innerHTML=html;content.setAttribute("style",style);content.className="_active";mask.className="_active"}function fetchGitHubRepo(repo){var url="https://api.github.com/repos/"+repo;$.getJSON(url,function(data){var counts=[+new Date,data.stargazers_count,data.forks_count];localStorage.setItem("gh:"+repo,JSON.stringify(counts));updateGitHubStats(counts[1],counts[2])})}function updateGitHubStats(stars,forks){$(".github_stars strong").text(stars);$(".github_forks strong").text(forks)}function initGitHub(url){if(!url){return}var repo=url.replace("https://github.com/","");var cache=localStorage.getItem("gh:"+repo);if(cache){try{var counts=JSON.parse(cache);updateGitHubStats(counts[1],counts[2]);var delta=new Date-counts[0];if(delta<0||delta>9e5){fetchGitHubRepo(repo)}}catch(error){fetchGitHubRepo(repo)}}else{fetchGitHubRepo(repo)}}initGitHub($(".github").attr("href"))});</script>
</body>
</html>